<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>
  <style>
    body { font-family: system-ui, sans-serif; background:#f7f7f7; padding:20px; }
    h2 { text-align:center; }
    table { width:100%; border-collapse:collapse; background:#fff; }
    th, td { padding:10px; border:1px solid #ddd; text-align:center; }
    th { background:#0088cc; color:#fff; }
    button { padding:6px 12px; border:none; border-radius:6px; cursor:pointer; background:#25D366; color:#fff; }
  </style>
</head>
<body>
  <h2>ğŸ“‹ Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
  <table id="ordersTable">
    <thead>
      <tr>
        <th>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…</th>
        <th>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ</th>
        <th>ğŸ•’ Ø§Ù„ÙˆÙ‚Øª</th>
        <th>ğŸ“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
        <th>ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
        <th>ğŸšš ØªØ³Ù„ÙŠÙ…</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const token = "8448514696:AAGzvoVb0Rgqd8cY9Y_WfKj_7xDMTa3CT-M";
    const chatId = "939054281";

    async function loadOrders() {
      const res = await fetch(`https://api.telegram.org/bot${token}/getUpdates`);
      const data = await res.json();

      const tbody = document.querySelector("#ordersTable tbody");
      tbody.innerHTML = "";

      data.result.forEach(update => {
        if (!update.message || !update.message.text) return;

        const text = update.message.text;
        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        const nameMatch = text.match(/ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: (.+)/);
        const phoneMatch = text.match(/ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: (.+)/);
        const timeMatch = text.match(/ğŸ•’ ÙˆÙ‚Øª Ø§Ù„ØªÙˆØµÙŠÙ„: (.+)/);
        const notesMatch = text.match(/ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª: (.+)/);
        const locationMatch = text.match(/ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: (.+)/);

        const name = nameMatch ? nameMatch[1] : "";
        const phone = phoneMatch ? phoneMatch[1] : "";
        const time = timeMatch ? timeMatch[1] : "";
        const notes = notesMatch ? notesMatch[1] : "";
        const location = locationMatch ? `<a href="${locationMatch[1]}" target="_blank">Ø±Ø§Ø¨Ø·</a>` : "";

        if (name && phone) {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${name}</td>
            <td>${phone}</td>
            <td>${time}</td>
            <td>${notes}</td>
            <td>${location}</td>
            <td><button onclick="deliver('${phone}')">ğŸšš ØªØ³Ù„ÙŠÙ…</button></td>
          `;
          tbody.appendChild(row);
        }
      });
    }

    function deliver(phone) {
      const msg = encodeURIComponent("Ø£Ù†Ø§ ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ù„ØªØ³Ù„ÙŠÙ… Ø·Ù„Ø¨Ùƒ ğŸšš");
      window.open(`https://wa.me/${phone}?text=${msg}`, "_blank");
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ÙˆØ­Ø© ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
    setInterval(loadOrders, 10000);
    loadOrders();
  </script>
</body>
</html>
