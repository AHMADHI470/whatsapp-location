<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>ğŸ° ØªÙˆØµÙŠÙ„ Ø¬ÙˆÙ„ÙŠ ÙƒÙŠÙƒ</title>

  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: linear-gradient(135deg, #fff0f4, #fde4ec);
      padding: 12px;
    }

    .card {
      max-width: 560px;
      margin: auto;
      background: #fff;
      padding: 16px;
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.12);
    }

    h2 {
      text-align: center;
      color: #d81b60;
      margin-bottom: 4px;
    }

    .subtitle {
      text-align: center;
      font-size: 14px;
      color: #666;
      margin-bottom: 14px;
    }

    label {
      font-weight: 600;
      margin-top: 12px;
      display: block;
    }

    input, textarea {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #ddd;
      margin-top: 6px;
      font-size: 16px;
    }

    textarea {
      min-height: 70px;
      resize: vertical;
    }

    #map {
      height: 360px;
      border-radius: 14px;
      margin-top: 14px;
      border: 2px solid #f8bbd0;
    }

    .hint {
      font-size: 13px;
      color: #555;
      margin-top: 6px;
    }

    button {
      width: 100%;
      margin-top: 16px;
      padding: 16px;
      border-radius: 14px;
      border: none;
      font-size: 17px;
      cursor: pointer;
      background: #d81b60;
      color: #fff;
      font-weight: bold;
    }

    button:disabled {
      opacity: .6;
      cursor: not-allowed;
    }

    .status {
      margin-top: 12px;
      font-size: 14px;
      min-height: 36px;
      white-space: pre-line;
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù…ÙˆØ¨Ø§ÙŠÙ„ */
    @media (max-width: 600px) {
      #map {
        height: 380px;
      }
    }
  </style>
</head>

<body>
  <div class="card">
    <h2>ğŸ° ØªÙˆØµÙŠÙ„ Ø¬ÙˆÙ„ÙŠ ÙƒÙŠÙƒ</h2>
    <div class="subtitle">
      Ø­Ø¯Ù‘Ø¯Ù†Ø§ Ù…ÙˆÙ‚Ø¹Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§â€¦ Ø¹Ø¯Ù‘Ù„ Ø¥Ø°Ø§ Ù„Ø²Ù… ğŸ˜„
    </div>

    <label>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…</label>
    <input id="name" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯" enterkeyhint="next">

    <label>ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
    <input id="phone" placeholder="093XXXXXXX"
           inputmode="tel" enterkeyhint="next">

    <label>ğŸ“ Ø¹Ù„Ø§Ù…Ø© Ù…Ù…ÙŠØ²Ø© (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ)</label>
    <input id="landmark"
           placeholder="Ø¨Ø§Ø¨ Ø£Ø²Ø±Ù‚ØŒ Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ØŒ Ø¬Ù†Ø¨ Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©"
           enterkeyhint="next">

    <label>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
    <textarea id="notes"
              placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù„Ù„Ø³Ø§Ø¦Ù‚ØŒ ÙˆÙ‚Øª Ù…Ù†Ø§Ø³Ø¨..."
              enterkeyhint="done"></textarea>

    <label>ğŸ—ºï¸ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙˆØµÙŠÙ„</label>
    <div class="hint">
      â€¢ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØªØ­Ø¯Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§<br>
      â€¢ Ø¥Ø°Ø§ ØºÙŠØ± Ø¯Ù‚ÙŠÙ‚ØŒ Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¤Ø´Ø± Ù„Ù…ÙƒØ§Ù†Ùƒ
    </div>

    <div id="map"></div>

    <button id="sendBtn">ğŸšš Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØµÙŠÙ„</button>

    <div class="status" id="status"></div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    /* ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Telegram (ÙƒÙ…Ø§ Ù‡ÙŠ Ø­Ø§Ù„ÙŠÙ‹Ø§) ===== */
    const token = "8448514696:AAGzvoVb0Rgqd8cY9Y_WfKj_7xDMTa3CT-M";
    const chatIds = ["939054281"];

    const status = document.getElementById("status");
    const sendBtn = document.getElementById("sendBtn");

    let map, marker;
    let selectedLat = null;
    let selectedLon = null;

    /* ===== ØªØ­Ù‚Ù‚ Ø£Ù† Ø§Ù„Ù…ÙƒØ§Ù† Ø³ÙƒÙ†ÙŠ ===== */
    async function isHumanLocation(lat, lon) {
      try {
        const res = await fetch(
          `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1`,
          { headers: { "User-Agent": "JulieCakeWeb/1.0" } }
        );
        const data = await res.json();
        const a = data.address || {};

        const hasStreet =
          a.road || a.residential || a.neighbourhood;
        const hasArea =
          a.suburb || a.city || a.town || a.village;

        return hasStreet && hasArea;
      } catch {
        return false;
      }
    }

    /* ===== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© ===== */
    map = L.map("map").setView([35.1318, 36.7532], 13);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 18
    }).addTo(map);

    /* ===== ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ø¤Ø´Ø± ===== */
    function setMarker(lat, lon, msg) {
      const ll = [lat, lon];
      map.setView(ll, 16);

      if (!marker) {
        marker = L.marker(ll, { draggable: true }).addTo(map);

        marker.on("dragend", async e => {
          const p = e.target.getLatLng();
          status.textContent = "ğŸ” Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹...";

          const ok = await isHumanLocation(p.lat, p.lng);
          if (!ok) {
            status.textContent =
              "âŒ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙƒØ§Ù† ØºÙŠØ± Ø³ÙƒÙ†ÙŠØŒ Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¤Ø´Ø± Ù„Ù…ÙƒØ§Ù† ØµØ­ÙŠØ­";
            return;
          }

          selectedLat = p.lat.toFixed(6);
          selectedLon = p.lng.toFixed(6);
          status.textContent = "âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­";
        });
      } else {
        marker.setLatLng(ll);
      }

      selectedLat = lat.toFixed(6);
      selectedLon = lon.toFixed(6);
      status.textContent = msg;
    }

    /* ===== ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ===== */
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        async pos => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;

          if (pos.coords.accuracy > 120) {
            setMarker(
              lat,
              lon,
              "âš ï¸ Ø¯Ù‚Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¶Ø¹ÙŠÙØ©ØŒ ÙŠØ±Ø¬Ù‰ Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¤Ø´Ø± Ù„Ù„ØªØ£ÙƒÙŠØ¯"
            );
            return;
          }

          const valid = await isHumanLocation(lat, lon);
          if (!valid) {
            setMarker(
              lat,
              lon,
              "âš ï¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ØºÙŠØ± Ù…Ù†Ø·Ù‚ÙŠØŒ Ø¹Ø¯Ù‘Ù„Ù‡ ÙŠØ¯ÙˆÙŠÙ‹Ø§"
            );
            return;
          }

          setMarker(
            lat,
            lon,
            "âœ… ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ØŒ ØªØ£ÙƒØ¯ Ù…Ù†Ù‡"
          );
        },
        () => {
          status.textContent =
            "âš ï¸ Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§";
        }
      );
    }

    /* ===== Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ===== */
    function sendToTelegram(text) {
      return Promise.all(
        chatIds.map(id =>
          fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              chat_id: id,
              text,
              parse_mode: "HTML"
            })
          })
        )
      );
    }

    sendBtn.addEventListener("click", () => {
      const name = document.getElementById("name").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const landmark = document.getElementById("landmark").value.trim();
      const notes = document.getElementById("notes").value.trim();

      if (!name || !phone) {
        status.textContent = "âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ";
        return;
      }

      if (!selectedLat || !selectedLon) {
        status.textContent = "âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙˆØµÙŠÙ„";
        return;
      }

      if (!landmark) {
        status.textContent =
          "âš ï¸ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ù…ÙŠØ²Ø© Ø¥Ù„Ø²Ø§Ù…ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„";
        return;
      }

      sendBtn.disabled = true;
      status.textContent = "ğŸ“¦ Ø¬Ø§Ø±Ù Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨...";

      const mapLink =
        `https://maps.google.com/?q=${selectedLat},${selectedLon}`;

      const text =
`ğŸ° <b>Ø·Ù„Ø¨ ØªÙˆØµÙŠÙ„ Ø¬Ø¯ÙŠØ¯ - Ø¬ÙˆÙ„ÙŠ ÙƒÙŠÙƒ</b>

ğŸ‘¤ <b>Ø§Ù„Ø§Ø³Ù…:</b> ${name}
ğŸ“ <b>Ø§Ù„Ù‡Ø§ØªÙ:</b> ${phone}
ğŸ“ <b>Ø¹Ù„Ø§Ù…Ø© Ù…Ù…ÙŠØ²Ø©:</b> ${landmark}
ğŸ“ <b>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</b> ${notes || "Ù„Ø§ ØªÙˆØ¬Ø¯"}

ğŸ—ºï¸ <a href="${mapLink}">ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</a>
`;

      sendToTelegram(text)
        .then(() => {
          status.innerHTML =
            "<span style='color:green;font-weight:bold;'>âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ØŒ Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ù‹Ø§</span>";
        })
        .catch(() => {
          sendBtn.disabled = false;
          status.textContent = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„";
        });
    });
  </script>
</body>
</html>
