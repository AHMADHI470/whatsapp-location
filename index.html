<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ° ØªÙˆØµÙŠÙ„ Ø¬ÙˆÙ„ÙŠ ÙƒÙŠÙƒ</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: linear-gradient(135deg, #fff3f6, #fce4ec);
      padding: 16px;
    }

    .card {
      max-width: 560px;
      margin: auto;
      background: #fff;
      padding: 18px;
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.1);
    }

    h2 {
      text-align: center;
      color: #d81b60;
      margin-bottom: 6px;
    }

    .subtitle {
      text-align: center;
      font-size: 14px;
      color: #777;
      margin-bottom: 14px;
    }

    label {
      font-weight: 600;
      margin-top: 12px;
      display: block;
    }

    input, textarea {
      width: 100%;
      padding: 11px;
      border-radius: 10px;
      border: 1px solid #ddd;
      margin-top: 6px;
      font-size: 15px;
    }

    textarea {
      resize: vertical;
      min-height: 70px;
    }

    #map {
      height: 320px;
      border-radius: 14px;
      margin-top: 14px;
      border: 2px solid #f8bbd0;
    }

    .hint {
      font-size: 13px;
      color: #666;
      margin-top: 6px;
    }

    button {
      width: 100%;
      margin-top: 14px;
      padding: 14px;
      border-radius: 14px;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }

    #sendBtn {
      background: #d81b60;
      color: #fff;
      font-weight: bold;
    }

    #sendBtn:disabled {
      opacity: .6;
      cursor: not-allowed;
    }

    .status {
      margin-top: 12px;
      font-size: 14px;
      min-height: 36px;
      white-space: pre-line;
    }
  </style>
</head>

<body>
  <div class="card">
    <h2>ğŸ° ØªÙˆØµÙŠÙ„ Ø¬ÙˆÙ„ÙŠ ÙƒÙŠÙƒ</h2>
    <div class="subtitle">Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø¨Ø¯Ù‚Ø© Ù„Ù†ÙˆØµÙ„Ùƒ Ø§Ù„Ø·Ø¹Ù… Ø§Ù„Ø­Ù„Ùˆ ğŸ˜‹</div>

    <label>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…</label>
    <input id="name" placeholder="Ù…Ø«Ø§Ù„: Ø¢ÙŠØ© Ù…Ø­Ù…Ø¯">

    <label>ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
    <input id="phone" placeholder="093XXXXXXX">

    <label>ğŸ“ Ø¹Ù„Ø§Ù…Ø© Ù…Ù…ÙŠØ²Ø© Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ù…Ù†Ø²Ù„ (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ)</label>
    <input id="landmark" placeholder="Ø¨Ø§Ø¨ Ø£Ø²Ø±Ù‚ØŒ Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ØŒ Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©">

    <label>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
    <textarea id="notes" placeholder="ÙˆÙ‚Øª Ù…Ù†Ø§Ø³Ø¨ØŒ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù„Ù„Ø³Ø§Ø¦Ù‚..."></textarea>

    <label>ğŸ—ºï¸ Ø§Ø®ØªØ± Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø© (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ)</label>
    <div class="hint">
      âš ï¸ ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆÙ‚Ø¹ Ø¯Ø§Ø®Ù„ Ø­ÙŠ Ø£Ùˆ Ø´Ø§Ø±Ø¹ Ø³ÙƒÙ†ÙŠ
    </div>

    <div id="map"></div>

    <button id="sendBtn">ğŸšš Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØµÙŠÙ„</button>

    <div class="status" id="status"></div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    const token = "8448514696:AAGzvoVb0Rgqd8cY9Y_WfKj_7xDMTa3CT-M";
    const chatIds = ["939054281", "6748885574"];

    const status = document.getElementById("status");
    const sendBtn = document.getElementById("sendBtn");

    let map, marker;
    let selectedLat = null;
    let selectedLon = null;

    // ====== ØªØ­Ù‚Ù‚ Ø£Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø³ÙƒÙ†ÙŠ ======
    async function isHumanLocation(lat, lon) {
      try {
        const res = await fetch(
          `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1`,
          { headers: { "User-Agent": "JulieCakeDelivery/1.0" } }
        );

        const data = await res.json();
        const addr = data.address || {};

        const hasStreet =
          addr.road || addr.residential || addr.neighbourhood;
        const hasArea =
          addr.suburb || addr.city || addr.town || addr.village;

        return hasStreet && hasArea;
      } catch {
        return false;
      }
    }

    // ====== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© ======
    map = L.map("map").setView([35.1318, 36.7532], 13);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 18
    }).addTo(map);

    // GPS ÙÙ‚Ø· Ù„ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        if (pos.coords.accuracy < 150) {
          map.setView(
            [pos.coords.latitude, pos.coords.longitude],
            15
          );
        }
      });
    }

    map.on("click", async e => {
      status.textContent = "ğŸ” Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹...";
      const lat = e.latlng.lat.toFixed(6);
      const lon = e.latlng.lng.toFixed(6);

      const valid = await isHumanLocation(lat, lon);

      if (!valid) {
        status.textContent =
          "âŒ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ø³ÙƒÙ†ÙŠ. ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆÙ‚Ø¹ Ø¯Ø§Ø®Ù„ Ø­ÙŠ Ø£Ùˆ Ø´Ø§Ø±Ø¹";
        return;
      }

      selectedLat = lat;
      selectedLon = lon;

      if (marker) {
        marker.setLatLng(e.latlng);
      } else {
        marker = L.marker(e.latlng).addTo(map);
      }

      status.textContent = "âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙˆØµÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­";
    });

    // ====== Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ======
    function sendToTelegram(text) {
      return Promise.all(
        chatIds.map(id =>
          fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              chat_id: id,
              text,
              parse_mode: "HTML"
            })
          })
        )
      );
    }

    sendBtn.addEventListener("click", () => {
      const name = document.getElementById("name").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const landmark = document.getElementById("landmark").value.trim();
      const notes = document.getElementById("notes").value.trim();

      if (!name || !phone) {
        status.textContent = "âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ";
        return;
      }

      if (!selectedLat || !selectedLon) {
        status.textContent = "âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø©";
        return;
      }

      if (!landmark) {
        status.textContent = "âš ï¸ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ù…ÙŠØ²Ø© Ø¥Ù„Ø²Ø§Ù…ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„";
        return;
      }

      sendBtn.disabled = true;
      status.textContent = "ğŸ“¦ Ø¬Ø§Ø±Ù Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨...";

      const mapLink = `https://maps.google.com/?q=${selectedLat},${selectedLon}`;

      const text =
`ğŸ° <b>Ø·Ù„Ø¨ ØªÙˆØµÙŠÙ„ Ø¬Ø¯ÙŠØ¯ - Ø¬ÙˆÙ„ÙŠ ÙƒÙŠÙƒ</b>

ğŸ‘¤ <b>Ø§Ù„Ø§Ø³Ù…:</b> ${name}
ğŸ“ <b>Ø§Ù„Ù‡Ø§ØªÙ:</b> ${phone}
ğŸ“ <b>Ø¹Ù„Ø§Ù…Ø© Ù…Ù…ÙŠØ²Ø©:</b> ${landmark}
ğŸ“ <b>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</b> ${notes || "Ù„Ø§ ØªÙˆØ¬Ø¯"}

ğŸ—ºï¸ <a href="${mapLink}">ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</a>
`;

      sendToTelegram(text)
        .then(() => {
          status.innerHTML =
            "<span style='color:green;font-weight:bold;'>âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ØŒ Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ù‹Ø§</span>";
        })
        .catch(() => {
          sendBtn.disabled = false;
          status.textContent = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„";
        });
    });
  </script>
</body>
</html>
