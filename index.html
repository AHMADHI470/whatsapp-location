<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø®Ø¯Ù…Ø© ØªÙˆØµÙŠÙ„ Ù…ØªØ¬Ø± Ø¬ÙˆÙ„ÙŠ ÙƒÙŠÙƒ</title>
  <style>
    body { font-family: system-ui, sans-serif; padding: 16px; background:#f7f7f7; }
    .card { max-width: 520px; margin: auto; background:#fff; padding:16px; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,.08); }
    h2 { text-align: center; margin-bottom: 8px; }
    p.welcome { text-align: center; font-weight: 600; margin-bottom: 20px; color: #444; }
    label { display:block; margin:10px 0 6px; font-weight:600; }
    input, textarea, button { width:100%; padding:10px; border:1px solid #ddd; border-radius:8px; font-size: 16px; }
    textarea { resize: vertical; min-height:60px; }
    button { cursor:pointer; color:#fff; border:none; margin-top:14px; border-radius:10px; }
    #locBtn { background:#0088cc; }
    .status { margin-top:10px; font-size:14px; color:#333; white-space: pre-line; min-height: 36px; }
  </style>
</head>
<body>
  <div class="card">
    <h2>Ø®Ø¯Ù…Ø© ØªÙˆØµÙŠÙ„ Ù…ØªØ¬Ø± Ø¬ÙˆÙ„ÙŠ ÙƒÙŠÙƒ</h2>
    <p class="welcome">Ø³Ø±Ø±Ù†Ø§ Ø¨ÙƒÙ…!</p>
    <h5>Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ù…Ù†Ù‡ Ø¹Ø¨Ø± Ø²Ø± (ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø¢Ù†)</h5>

    <label for="name">Ø§Ø³Ù…Ùƒ</label>
    <input id="name" placeholder="Ù…Ø«Ø§Ù„: Ø¢ÙŠØ© Ù…Ø­Ù…Ø¯" autocomplete="off" />

    <label for="phone">Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ</label>
    <input id="phone" placeholder="Ù…Ø«Ø§Ù„: 093XXXXXXX" autocomplete="off" inputmode="tel" />

    <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
    <textarea id="notes" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ Ù‡Ù†Ø§"></textarea>

    <button id="locBtn" type="button">ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø¢Ù†</button>

    <div class="status" id="status"></div>
  </div>

  <script>
    // ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª Ùˆ chatIds Ø§Ù„Ù…Ø³ØªÙ„Ù…ÙŠÙ†
    const token = "8448514696:AAGzvoVb0Rgqd8cY9Y_WfKj_7xDMTa3CT-M";
    const chatIds = ["939054281", "6748885574"]; // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†

    const status = document.getElementById("status");
    const locBtn = document.getElementById("locBtn");
    const nameInput = document.getElementById("name");
    const phoneInput = document.getElementById("phone");
    const notesInput = document.getElementById("notes");

    function isSameData(newData) {
      const lastDataJson = sessionStorage.getItem("lastOrderData");
      if (!lastDataJson) return false;
      const lastData = JSON.parse(lastDataJson);
      return JSON.stringify(lastData) === JSON.stringify(newData);
    }

    function saveLastData(data) {
      sessionStorage.setItem("lastOrderData", JSON.stringify(data));
    }

    async function sendMessage(text) {
      const requests = chatIds.map(id =>
        fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ chat_id: id, text })
        })
      );
      await Promise.all(requests);
    }

    async function sendOrder(lat, lon) {
      const name = nameInput.value.trim();
      const phone = phoneInput.value.trim();
      const notes = notesInput.value.trim() || "Ù„Ø§ ØªÙˆØ¬Ø¯";

      if (!name || !phone) {
        status.textContent = "âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ.";
        return;
      }

      if (lat === null || lon === null) {
        status.textContent = "âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£ÙˆÙ„Ø§Ù‹.";
        return;
      }

      const dataToSend = { name, phone, notes, lat: +lat.toFixed(6), lon: +lon.toFixed(6) };

      if (isSameData(dataToSend)) {
        alert("Ù„Ù‚Ø¯ Ø£Ø±Ø³Ù„Øª Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø³Ø¨Ù‚Ù‹Ø§ØŒ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ùˆ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯Ù‹Ø§.");
        return;
      }

      status.textContent = "Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨...";

      const message =
        `ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${name}\n` +
        `ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${phone}\n` +
        `ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${notes}\n` +
        `ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: https://maps.google.com/?q=${lat},${lon}`;

      try {
        await sendMessage(message);
        status.textContent = "âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­.";
        saveLastData(dataToSend);
      } catch {
        status.textContent = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.";
      }
    }

    locBtn.addEventListener("click", () => {
      if (!navigator.geolocation) {
        status.textContent = "âš ï¸ Ù…ÙŠØ²Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ù…ØªØµÙØ­Ùƒ.";
        return;
      }
      status.textContent = "Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...";
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        sendOrder(lat, lon);
      }, err => {
        status.textContent = "âŒ ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹.";
      });
    });
  </script>
</body>
</html>
